(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{163:function(e,t,s){"use strict";s.r(t);var i=s(197),l=s(198),a={data:()=>({LANG:LANG,editForm:{hyper_text:"",title:"",content:"",send_type:"",type_value:""},detailform:{hyper_text:"",title:"",content:"",send_type:"",updated:"",status:""},formConfig:[{prop:"hyper_text",value:"",label:"超文本格式",type:"select",list:ARRAYS.textState},{prop:"title",value:"",type:"text",label:"邮件标题",rules:[{require:!0}]},{prop:"content",value:"",type:"markdown",label:"邮件内容",rules:[{require:!0}]},{prop:"send_type",value:"",label:"发送类型",type:"select",list:[{value:"1",label:"会员层级"},{value:"2",label:"代理"},{value:"3",label:"自定义"}],rules:[{require:!0}]},{prop:"type_value",value:"",label:"会员层级",sReset:!1,checkAll:!0,allBtnShow:!0,type:"select",list:[],Arr:[],ifVal:"1",ifKey:"send_type"},{prop:"type_value",value:"1",type:"checkbox",label:"",valLabel:"全部代理",ifVal:"2",ifKey:"send_type"},{prop:"type_value",value:"",label:"自定义接收人",type:"textarea",ifVal:"3",ifKey:"send_type",placeholder:"多个用户名请用英文逗号隔开"}],labelWidth:"110px",type:"default",formTitel:"新增邮件",formType:"",editVisible:{state:!1},isEdit:{state:!1},checkAll:[],checkedList:[],isIndeterminate:!0,tableUrl:"",columnsUrl:"",baseUrl:"",updateType:!1,nowId:-1,readOnly:!1,tabOperation:[{label:"批量删除",fn:"delMeg"}],dialogTableVisible:!1}),components:{tablegrid:i.a,formEdit:l.a},methods:{init(){this.tableUrl=URL.api+ROUTES.GET.system.emails,this.baseUrl=URL.api+ROUTES.GET.system.emails,this.columnsUrl="static/json/systemSettings/emailList/columns.json",this.$.autoAjax("get",URL.api+ROUTES.GET.user.levels,"",{ok:e=>{if(0==e.state&&e.data){let t=e.data;for(let e in t)this.formConfig[4].list.push({label:t[e].name,value:t[e].id})}},p:()=>{},error:e=>{console.log(e)}})},AddNew(){this.editVisible.state=!0},saveEditForm(){if(this.updateType=!1,this.checkedList&&"1"==this.editForm.send_type){let e=this.checkedList,t=this.levels,s=[];for(let i in t)for(let l in e)t[i].label==e[l]&&s.push(t[i].value);this.editForm.type_value=s.toString()}this.fullscreenLoading=!0;let e="";this.editForm.id=this.nowId,"edit"==this.formType?(this.resetEditForm(),this.editFormVisible=!1,this.formType=""):this.$.autoAjax("put",URL.api+ROUTES.PUT.system.email.$,this.editForm,{ok:t=>{0==t.state&&t.data?("add"==this.formType?(e=LANG["恭喜您，新增邮件成功！"]||"恭喜您，新增邮件成功！",this.updateType=!0):(e=LANG["恭喜您，邮件修改成功！"]||"恭喜您，邮件修改成功！",this.updateType=!0),this.$message.success(e)):("add"==this.formType?(this.fullscreenLoading=!1,e=LANG["新增邮件失败，请稍候重试！"]||"新增邮件失败，请稍候重试！"):e=LANG["邮件修改失败，请稍候重试！"]||"邮件修改失败，请稍候重试！",this.$message.error(e),this.updateType=!1),this.fullscreenLoading=!1,this.resetEditForm(),this.editFormVisible=!1,this.formType=""},p:()=>{},error:e=>{console.log(e)}})},getForm(e){"2"==e.formObj.send_type&&(e.formObj.type_value="1"),"true"==e.formObj.hyper_text?e.formObj.hyper_text=!0:e.formObj.hyper_text=!1,this.updateType=!1,this.$.autoAjax("put",URL.api+"/system/email",e.formObj,{ok:e=>{0==e.state&&e.data?(this.$message.success(LANG["邮件添加成功"]||"邮件添加成功"),this.updateType=!0):this.$message.error(LANG["邮件添加失败"]||"邮件添加失败")},p:()=>{},error:e=>{console.log(e)}})},doHandle(e){switch(e.fn){case"doDetial":this.doDetial(e.row);break;case"doSend":this.doSend(e.row)}},doDetial(e){let t=this.detailform;for(let s in e)t[s]=e[s];let s=this;setTimeout(function(){s.dialogTableVisible=!0,s.loading=!1},500)},doSend(e){let t=e.id;this.updateType=!1,this.$.autoAjax("post",URL.api+"/system/email.send",{id:parseInt(t)},{ok:e=>{0==e.state&&e.data?(this.$message.success(LANG["邮件发布成功！"]||"邮件发布成功！"),this.updateType=!0):e.msg?this.$message.error(e.msg):this.$message.error(LANG["邮件发布失败！"]||"邮件发布失败！")},p:()=>{},error:e=>{console.log(e)}})},delMeg(e){this.updateType=!1;let t=e.map(function(e){return e.id}).join(","),s=URL.api+ROUTES.DELETE.system.mail+"?ids="+t;this.$.autoAjax("delete",s,"",{ok:e=>{0===e.state?(this.$message({message:"成功删除所选邮件！",type:"success"}),this.updateType=!0):(this.$message({message:"删除邮件失败！",type:"error"}),this.updateType=!0)},p:()=>{},error:e=>{console.log(e)}}).catch(function(e){})},doOperation(e){switch(e.fn){case"delMeg":this.delMeg(e.rows)}}},computed:{},mounted(){},created(){this.init()}},o=s(24);var r=function(e){s(537)},d=Object(o.a)(a,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"emailList"}},[s("el-col",{staticClass:"pb"},[s("el-button",{staticClass:"btn_right",attrs:{type:"primary",size:"small"},domProps:{textContent:e._s(e.LANG["新增邮件"]||"新增邮件")},on:{click:e.AddNew}})],1),e._v(" "),s("el-col",[s("tablegrid",{attrs:{columnsUrl:e.columnsUrl,tableIndex:!1,tableCheck:!0,tabOperation:e.tabOperation,updated:e.updateType,tableUrl:e.tableUrl,showRefresh:!0},on:{"do-handle":e.doHandle,"do-operation":e.doOperation}})],1),e._v(" "),s("el-col",[s("formEdit",{attrs:{formTitel:e.formTitel,formVisible:e.editVisible,formConfig:e.formConfig,type:e.type,labelWidth:e.labelWidth,isEdit:e.isEdit,formType:e.formType},on:{"get-form":e.getForm}})],1),e._v(" "),s("el-col",[s("el-dialog",{staticClass:"detail",attrs:{title:"邮件"},model:{value:e.dialogTableVisible,callback:function(t){e.dialogTableVisible=t},expression:"dialogTableVisible"}},[s("el-form",{attrs:{model:e.detailform}},[s("el-form-item",{attrs:{label:"超文本"}},[s("span",[e._v(e._s(e.LANG[e.detailform.hyper_text?"是":"否"]||e.detailform.hyper_text?"是":"否"))])]),e._v(" "),s("el-form-item",{attrs:{label:"邮件标题"}},[s("span",[e._v(e._s(e.LANG[e.detailform.title]||e.detailform.title))])]),e._v(" "),s("el-form-item",{attrs:{label:"发送时间"}},[s("span",[e._v(e._s(e.LANG[e.detailform.created]||e.detailform.created))])]),e._v(" "),s("el-form-item",{attrs:{label:"发送类型"}},[1==e.detailform.send_type?s("span",[e._v(e._s(e.LANG["会员层级"]||"会员层级"))]):e._e(),e._v(" "),2==e.detailform.send_type?s("span",[e._v(e._s(e.LANG["代理"]||"代理"))]):e._e(),e._v(" "),3==e.detailform.send_type?s("span",[e._v(e._s(e.LANG["自定义"]||"自定义"))]):e._e(),e._v(" "),e.detailform.recipient?s("p",{staticStyle:{"margin-left":"70px"}},[e._v(e._s(e.detailform.recipient))]):e._e()]),e._v(" "),s("el-form-item",{attrs:{label:"发送状态"}},[s("span",[e._v(e._s(e.LANG["1"===e.detailform.status?"已发送":"未发送"]||("1"===e.detailform.status?"已发送":"未发送")))])]),e._v(" "),s("el-form-item",{attrs:{label:"发送内容"}},[s("p",[e._v(e._s(e.LANG[e.detailform.content]||e.detailform.content))])])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("关 闭")])],1)],1)],1)],1)},[],!1,r,"data-v-563c13e4",null);t.default=d.exports},537:function(e,t,s){}}]);