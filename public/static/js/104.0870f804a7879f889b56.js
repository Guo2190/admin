(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{142:function(e,t,a){"use strict";a.r(t);var l=a(202),s=a(203),i=a(206),o={data:()=>({LANG:LANG,columnsUrl:"",tableUrl:"",baseUrl:"",formVisible:{state:!1},searchConfig:[{prop:"type",value:"",label:"类型",type:"select",list:[{value:"",label:"全部"},{value:"2",label:"一般消息"},{value:"1",label:"重要消息"}]},{prop:"title",value:"",type:"text",label:"标题"},{type:"dateGroup",label:"日期",prop:[{prop:"start_time",value:"",label:"开始时间"},{prop:"end_time",value:"",label:"结束时间"}]},{prop:"admin_name",value:"",type:"text",label:"发布人"}],formConfig:[{prop:"send_type",value:"1",label:"发送类型",type:"select",list:[{value:"1",label:"会员等级"},{value:"2",label:"代理"},{value:"3",label:"自定义"}]},{prop:"send_type_valueOne",value:[],label:"使用等级",sReset:!1,checkAll:!1,allBtnShow:!0,type:"checkGroup",list:[],Arr:[],ifKey:"send_type",ifVal:"1"},{prop:"send_type_valueTwo",value:"",type:"textarea",label:"自定义接收人",placeholder:"注:自定义接收人只能发送到会员账号.",ifKey:"send_type",ifVal:"3"},{prop:"message_type",value:"1",label:"消息类型",type:"select",list:[{value:"2",label:"一般消息"},{value:"1",label:"重要消息"}],rules:[{require:!0}]},{prop:"title",value:"",type:"text",label:"标题",rules:[{require:!0}]},{prop:"desc",value:"",type:"textarea",label:"内容",rules:[{require:!0},{max:230,min:1}]}],formType:"",formTitel:"",isEdit:{},labelWidth:"110px",nowId:-1,dialogVisible:!1,detailform:{},loading:!1,updated:!1,confirmConfig:{state:!1,msg:"",fn:"",obj:null}}),components:{tablegrid:l.a,formedit:s.a,confirm:i.a},methods:{init(){this.tableUrl=URL.api+ROUTES.GET.messsage.show+"?start_time="+sessionStorage.dateTimeStart+"&end_time="+sessionStorage.dateTimeEnd,this.baseUrl=URL.api+ROUTES.GET.messsage.show,this.columnsUrl="static/json/webSet/msgMangemnet/columns.json";let e=this;this.$.autoAjax("get",URL.api+ROUTES.GET.user.level.list,"",{ok:t=>{if(0==t.state&&t.data){let a=t.data||[];for(let t in a)e.formConfig[1].list.push(a[t].level),e.formConfig[1].Arr.push({label:"VIP"+a[t].level,value:a[t].level.toString()})}},p:()=>{},error:e=>{console.log(e)}})},doQuery(e){e.item.title&&(this.tableUrl=this.baseUrl+this.addSearch(e.item))},getTextarea(e){},doAdd(){this.formType="add",this.formTitel="新增消息",this.formVisible.state=!0},saveForm(e){switch(this.updated=!1,e.formObj.send_type){case"1":e.formObj.send_type_value=e.formObj.send_type_valueOne.toString()||"";break;case"2":e.formObj.send_type_value="1";break;case"3":e.formObj.send_type_value=e.formObj.send_type_valueTwo||""}let t=e.formObj,a={};for(let e in t)a[e]=t[e];delete a.send_type_valueOne,delete a.send_type_valueTwo,a.admin_uid=sessionStorage.userId;let l=this;this.$.autoAjax("post",URL.api+ROUTES.POST.message.new,a,{ok:e=>{0==e.state&&e.data?(l.$message.success(LANG["消息添加成功！"]||"消息添加成功！"),l.updated=!0):l.$message.error(LANG["消息添加失败！请稍候重试"]||"消息添加失败！请稍候重试")},p:()=>{},error:e=>{console.log(e)}})},doHandle(e){switch(this.updated=!1,this.nowId=parseInt(e.row.id),e.fn){case"doDetail":this.doDetail(e.row);break;case"doDesable":this.doDesable(e.row);break;case"doDel":this.doDel(e.row)}},doDetail(e){if(-1===this.nowId)return;this.loading=!0;let t=this.detailform,a=this;this.$.autoAjax("get",URL.api+ROUTES.GET.messsage.show+"/"+this.nowId,"",{ok:e=>{if(0==e.state&&e.data){let a=e.data||[];for(let e in a)t[e]=a[e]}a.dialogVisible=!0,a.loading=!1},p:()=>{},error:e=>{a.$message.error(LANG["未知错误，请稍后重试"]||"未知错误，请稍后重试"),a.loading=!1}})},doDesable(e){this.loading=!0;let t=this;this.$.autoAjax("patch",URL.api+ROUTES.PATCH.message.to+"?id="+this.nowId,"",{ok:e=>{0==e.state&&e.data&&t.$message.success(LANG["恭喜您，发布成功！"]||"恭喜您，发布成功！"),t.updated=!0,t.loading=!1},p:()=>{},error:e=>{t.$message.error(LANG["发布失败，请稍后重试"]||"发布失败，请稍后重试")}})},doDel(e){-1!==this.nowId&&(this.confirmConfig.state=!0,this.confirmConfig.msg=(LANG["确定删除"]||"确定删除")+'"'+e.title+'"'+(LANG["吗？"]||"吗？"),this.confirmConfig.fn="delete")},resetForm(){this.tableUrl=this.baseUrl+"?start_time="+sessionStorage.dateTimeStart+"&end_time="+sessionStorage.dateTimeEnd},doQuery(e){this.tableUrl=this.baseUrl+this.addSearch(e.item)},doConfirm(e){this.loading=!0;let t=this;switch(e.fn){case"delete":this.$.autoAjax("delete",URL.api+"/messages?ids="+this.nowId,"",{ok:e=>{0==e.state&&e.data&&t.$message.success(LANG["恭喜您，删除成功！"]||"恭喜您，删除成功！"),t.loading=!1,t.updated=!0},p:()=>{},error:e=>{t.$message.error(LANG["删除失败，请稍后重试"]||"删除失败，请稍后重试"),t.loading=!1}})}}},created(){this.init()}},r=a(10);var d=function(e){a(424)},n=Object(r.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"clearfix",attrs:{id:"msgMangagment"}},[a("el-col",{staticClass:"pb"},[a("formedit",{attrs:{formVisible:e.formVisible,formConfig:e.searchConfig,type:"search",labelWidth:"60px",isEdit:e.isEdit,addText:e.LANG["新增消息"]||"新增消息"},on:{"add-new":e.doAdd,"do-query":e.doQuery,"reset-form":e.resetForm}})],1),e._v(" "),a("el-col",[a("tablegrid",{attrs:{columnsUrl:e.columnsUrl,tableUrl:e.tableUrl,updated:e.updated,showRefresh:!1},on:{"do-handle":e.doHandle}})],1),e._v(" "),a("el-col",[a("formedit",{attrs:{formVisible:e.formVisible,formConfig:e.formConfig,type:"default",formType:e.formType,labelWidth:e.labelWidth,isEdit:e.isEdit,formTitel:e.formTitel},on:{"get-textarea":e.getTextarea,"get-form":e.saveForm}})],1),e._v(" "),a("el-col",[a("el-dialog",{staticClass:"detail",attrs:{title:e.LANG["消息详情"]||"消息详情",size:"tiny"},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[a("el-form",{attrs:{model:e.detailform,"label-width":"110px"}},[a("el-form-item",{attrs:{label:e.LANG["发送类型："]||"发送类型："}},["1"===e.detailform.send_type?a("span",[e._v(e._s(e.LANG["会员层级"]||"会员层级"))]):e._e(),e._v(" "),"2"===e.detailform.send_type?a("span",[e._v(e._s(e.LANG["全部代理"]||"全部代理"))]):e._e(),e._v(" "),"3"===e.detailform.send_type?a("span",[e._v(e._s(e.LANG["自定义"]||"自定义"))]):e._e()]),e._v(" "),"1"===e.detailform.send_type?a("el-form-item",{attrs:{label:e.LANG["会员层级："]||"会员层级："}},[a("p",[e._v(e._s(e.detailform.recipient))])]):e._e(),e._v(" "),"3"===e.detailform.send_type?a("el-form-item",{attrs:{label:e.LANG["自定义接收人："]||"自定义接收人："}},[a("span",[e._v(e._s(e.detailform.recipient))])]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.LANG["消息类型："]||"消息类型："}},["2"===e.detailform.type?a("span",[e._v(e._s(e.LANG["一般消息"]||"一般消息"))]):e._e(),e._v(" "),"1"===e.detailform.type?a("span",[e._v(e._s(e.LANG["重要消息"]||"重要消息"))]):e._e()]),e._v(" "),a("el-form-item",{attrs:{label:e.LANG["标题："]||"标题："}},[a("span",[e._v(e._s(e.detailform.title))])]),e._v(" "),a("el-form-item",{attrs:{label:e.LANG["内容："]||"内容："}},[a("p",[e._v(e._s(e.detailform.content))])])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("关 闭")])],1)],1)],1),e._v(" "),a("confirm",{attrs:{confirmConfig:e.confirmConfig},on:{"do-confirm":e.doConfirm}})],1)},[],!1,d,null,null);t.default=n.exports},424:function(e,t,a){}}]);