(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{122:function(e,t,s){"use strict";s.r(t);var i=s(202),c=s(206),n=(s(15),{data:()=>({LANG:LANG}),props:{checkGrounpList:Array},methods:{handleCheckAllChange(e,t,s,i){e?(this.checkGrounpList[i].checkedChildren=this.checkGrounpList[i].children,this.checkGrounpList[i].childrenStatus.forEach(e=>{e.status=!0})):(this.checkGrounpList[i].checkedChildren=[],this.checkGrounpList[i].childrenStatus.forEach(e=>{e.status=!1}))},handleCheckedCitiesChange(e,t,s){let i=e.length;this.checkGrounpList[s].checkAll=i===t.length,this.checkGrounpList[s].childrenStatus.forEach(e=>{e.status=!1});for(let e of this.checkGrounpList[s].checkedChildren)this.checkGrounpList[s].childrenStatus.forEach(t=>{e===t.cn_name&&(t.status=!0)})}},mounted(){},created(){}}),r=s(10);var a=function(e){s(501)},h=Object(r.a)(n,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._l(e.checkGrounpList,function(t,i){return s("div",{key:i,staticClass:"checkboxContainer"},[s("el-checkbox",{on:{change:function(s){return e.handleCheckAllChange(t.checkAll,t.children,t.isIndeterminate,i)}},model:{value:t.checkAll,callback:function(s){e.$set(t,"checkAll",s)},expression:"item.checkAll"}},[e._v(e._s(t.name))]),e._v(" "),s("el-checkbox-group",{on:{change:function(s){return e.handleCheckedCitiesChange(t.checkedChildren,t.children,i)}},model:{value:t.checkedChildren,callback:function(s){e.$set(t,"checkedChildren",s)},expression:"item.checkedChildren"}},e._l(t.children,function(t,i){return s("el-checkbox",{key:i,staticStyle:{"margin-right":"5px"},attrs:{label:t}},[e._v(e._s(t))])}),1)],1)}),0)},[],!1,a,"data-v-29410f7a",null).exports,o={data:()=>({LANG:LANG,columnsUrl:"",tableUrl:"",updated:!1,editFormTtile:"",editFormVisible:!1,btnEditText:"",editForm:{id:-1,role:"",roleList:[],member_control:{true_name:!1,bank_card:!1,address_book:!1,user_status:!1}},editFormRules:{role:[{required:!0,message:LANG["请输入角色名称"]||"请输入角色名称",trigger:"blur"}]},formType:"add",permissionsList:[],defaultProps:{children:"children",label:"name"},defaultChecked:[],num:500,loading:!1,arrId:-1,updateList:[],confirmConfig:{state:!1,msg:"",fn:"",obj:null},checkGrounpList:[{name:"真实姓名：",checkAll:!1,children:["真实姓名"],checkedChildren:[],childrenStatus:[{cn_name:"真实姓名",en_name:"true_name",status:!1}]},{name:"状态控制",checkAll:!1,children:["停号","封号","黑名单","踢出在线","自我限制"],checkedChildren:[],childrenStatus:[{cn_name:"停号",en_name:"account_disabled",status:!1},{cn_name:"封号",en_name:"account_forbidden",status:!1},{cn_name:"黑名单",en_name:"account_black",status:!1},{cn_name:"踢出在线",en_name:"account_kick",status:!1},{cn_name:"自我限制",en_name:"account_limit",status:!1}]},{name:"银行信息",checkAll:!1,children:["银行卡号和开户信息"],checkedChildren:[],childrenStatus:[{cn_name:"银行卡号和开户信息",en_name:"bank_card",status:!1}]},{name:"联系信息",checkAll:!1,children:["qq","手机号码","邮箱","微信","skype","安全问题与答案","出生日期","出生地","性别","邮编与国籍","货币与语言","身份证号码"],checkedChildren:[],childrenStatus:[{cn_name:"qq",en_name:"qq",status:!1},{cn_name:"手机号码",en_name:"mobile",status:!1},{cn_name:"邮箱",en_name:"email",status:!1},{cn_name:"微信",en_name:"weixin",status:!1},{cn_name:"skype",en_name:"skype",status:!1},{cn_name:"安全问题与答案",en_name:"answer",status:!1},{cn_name:"出生日期",en_name:"birth",status:!1},{cn_name:"出生地",en_name:"address",status:!1},{cn_name:"性别",en_name:"gender",status:!1},{cn_name:"邮编与国籍",en_name:"nationality",status:!1},{cn_name:"货币与语言",en_name:"language",status:!1},{cn_name:"身份证号码",en_name:"idcard",status:!1}]}],checkExportList:[{name:"全选",checkAll:!1,children:["有效用户导出","优惠申请导出","线上充值导出","公司入款导出","会员提现导出","返水导出"],checkedChildren:[],childrenStatus:[{cn_name:"有效用户导出",en_name:"valid_user_export",status:!1},{cn_name:"优惠申请导出",en_name:"active_applys_export",status:!1},{cn_name:"线上充值导出",en_name:"deposit_onlines_export",status:!1},{cn_name:"公司入款导出",en_name:"deposit_offlines_export",status:!1},{cn_name:"会员提现导出",en_name:"user_withdraws_export",status:!1},{cn_name:"返水导出",en_name:"rebate_details_export",status:!1}]}]}),components:{tablegrid:i.a,confirm:c.a,checkgroup:h},methods:{init(){this.columnsUrl="/static/json/accoutManage/childRoleAccount/columns.json",this.tableUrl=URL.api+ROUTES.GET.sub.accounts.role;let e=this,t=this.permissionsList,s=this.editForm.roleList;this.arrId=-1,this.permissionsList.splice(0,e.permissionsList.length),this.loading=!0,this.$.autoAjax("get",URL.api+ROUTES.GET.sub.accounts.auth+"?id=1","",{ok:i=>{if(0===i.state&&i.data){let c=i.data.routes||[];for(let e=0;e<c[9].children.length;e++)if("/domainNameManage"===c[9].children[e].path){c[9].children.splice(e,1);break}for(let i in c)e.arrId++,s.push({id:e.arrId,name:c[i].name,action:[],path:c[i].path,children:this.getChilds(c[i].children,!0)}),t.push({id:e.arrId,name:c[i].name,action:c[i].action,actionList:this.getActions(c[i]),path:c[i].path,children:this.getChilds(c[i].children)})}e.loading=!1},p:()=>{},error:e=>{console.log(e)}}).catch(t=>{e.loading=!1,e.$message.error(LANG["未知错误，请稍后重试！"]||"未知错误，请稍后重试！")})},getActions(e){let t=e.action,s=[];for(let e in t){switch(t[e]){case"delete":s.push({id:this.num++,name:"删除",fn:"delete"});break;case"update":s.push({id:this.num++,name:"修改",fn:"update"});break;case"fetch":s.push({id:this.num++,name:"查询",fn:"fetch"});break;case"insert":s.push({id:this.num++,name:"新增",fn:"insert"})}}return s},getChilds(e,t){let s=e||[],i=[];for(let e in s)this.arrId++,t?i.push({id:this.arrId,name:s[e].name,action:[],path:s[e].path}):i.push({id:this.arrId,name:s[e].name,action:s[e].action,children:this.getActions(s[e]),path:s[e].path});return i},doAdd(){this.formType="add",this.editForm.id=-1,this.editForm.role="",this.editFormTtile="新建子帐号",this.btnEditText="保存",this.checkGrounpList.forEach(e=>{e.checkAll=!1,e.checkedChildren=[],e.childrenStatus.forEach(e=>{e.status=!1})}),this.checkExportList.forEach(e=>{e.checkAll=!1,e.checkedChildren=[],e.childrenStatus.forEach(e=>{e.status=!1})}),this.editFormVisible=!0,this.$refs.tree&&this.$refs.tree.setCheckedKeys([])},doHandle(e){"doEdit"==e.fn?this.doEdit(e.row):"doDelete"==e.fn&&this.doDelete(e.row)},doDelete(e){parseInt(e.id)&&0===parseInt(e.num)?(this.confirmConfig.state=!0,this.confirmConfig.msg=(this.LANG["确定删除"]||"确定删除")+'"'+e.role+'"'+(this.LANG["吗？"]||"吗？"),this.confirmConfig.fn="delete",this.confirmConfig.obj=e):parseInt(e.num)>0&&this.$message.error(LANG["角色有使用，不可删除！"]||"角色有使用，不可删除！")},doConfirm(e){this.loading=!0;let t=this;switch(e.fn){case"delete":if(parseInt(e.obj.id)>0&&0===parseInt(e.obj.num)){this.updated=!1;let t=this;this.$.autoAjax("delete",URL.api+ROUTES.DELETE.sub.account.del+"?id="+parseInt(e.obj.id),"",{ok:e=>{0===e.state&&e.data?(t.updated=!0,t.$message.success(LANG["恭喜您，角色删除成功！"]||"恭喜您，角色删除成功！")):2===e.state&&t.$message.error(LANG["角色删除失败，该角色名不存在"]||"角色删除失败，该角色名不存在")},p:()=>{},error:e=>{console.log(e)}}),t.loading=!1}else parseInt(row.num)>0&&(t.loading=!1,this.$message.error(LANG["角色有帐号使用，不可删除！"]||"角色有帐号使用，不可删除！"))}},resetForm(){this.$refs.editForm.resetFields();let e=this.editForm.member_control;for(let t in e)e[t]=!1;this.editFormVisible=!1,this.$refs.tree.setCheckedKeys([])},saveFrom(){var e=this;e.$refs.editForm.validate(t=>{let s={},i={};for(let e of this.checkGrounpList)e.childrenStatus.map(e=>{s[e.en_name]=e.status});for(let e of this.checkExportList)e.childrenStatus.map(e=>{i[e.en_name]=e.status});if(t){e.loading=!0,this.getCheckTree(),this.updated=!1;let t="add"===this.formType?URL.api+ROUTES.GET.sub.accounts.role:URL.api+ROUTES.GET.sub.accounts.role+"?id="+this.editForm.id,c={role_name:this.editForm.role,auth:this.editForm.roleList,member_control:s,export_control:i};this.$.autoAjax("put",t,c,{ok:t=>{0==t.state&&t.data?("add"===this.formType?this.$message.success(LANG["新增角色成功"]||"新增角色成功"):(console.log(c),this.$message.success(LANG["修改角色成功"]||"修改角色成功")),this.updated=!0):405==t.state?"add"===this.formType?this.$message.error(LANG["新增角色失败,权限不足"]||"新增角色失败,权限不足"):this.$message.error(LANG["修改角色失败,权限不足"]||"修改角色失败,权限不足"):"add"===this.formType?this.$message.error((t.msg?t.msg:"")+(LANG["新增角色失败"]||"新增角色失败")):this.$message.error((t.msg?t.msg:"")+(LANG["修改角色失败"]||"修改角色失败")),e.initRoleList(),e.loading=!1,this.editFormVisible=!1},p:()=>{},error:e=>{console.log(e)}}).catch(t=>{e.loading=!1,this.$message.error(t.data.msg+LANG["未知错误，请稍后重试"]||"未知错误，请稍后重试")}),e.resetForm()}else e.$message.error(LANG["验证未通过，请修改后提交"]||"验证未通过，请修改后提交")})},initRoleList(){this.editForm.roleList.forEach(e=>{e.action=[],e.children&&e.children.length>0&&e.children.forEach(e=>{e.action=[]})})},setActions(e,t,s){if(void 0===this.permissionsList[t].children[s])return;let i=this.permissionsList[t].children[s].children,c=this.updateList;e.forEach(e=>{i.forEach(t=>{t.fn===e&&c.push(t.id)})})},setCheckedKeys(e){this.$refs.tree.setCheckedKeys(e)},getCheckTree(){let e=this.$refs.tree.getCheckedNodes(),t=this.permissionsList,s=this.editForm.roleList,i=-1,c=-1;for(let n in e)e[n].fn&&t.forEach((t,r)=>{i=r,t.children&&t.children.forEach((t,r)=>{c=r,t.children&&t.children.forEach(t=>{if(t.id===e[n].id){let e=s[i].action,n=0;for(let s in e)if(e[s]===t.fn){n++;break}0===n&&e.push(t.fn),s[i].children[c].action.push(t.fn)}})})})},doEdit(e){this.formType="edit",this.editForm.id=e.id;let t=this.editForm,s=this;this.loading=!0;this.$refs.tree;this.$.autoAjax("get",this.tableUrl+"?id="+e.id,"",{ok:e=>{if(0==e.state&&e.data){let i=e.data[0].auth||[];t.role=e.data[0].role||"";let c=e.data[0].export_control||{},n=0,r=0;this.checkExportList.forEach(e=>{e.checkAll=!1,e.checkedChildren=[],e.childrenStatus.forEach((t,s)=>{r++,c[t.en_name]&&(n++,e.checkedChildren.push(t.cn_name)),t.status=!1})}),n===r&&(this.checkExportList[0].checkAll=!0);let a=e.data[0].member_control||{};this.checkGrounpList.forEach(e=>{e.checkAll=!1,e.checkedChildren=[],e.childrenStatus.forEach(e=>{e.status=!1})}),a.true_name&&(this.checkGrounpList[0].checkAll=!0,this.checkGrounpList[0].checkedChildren.push("真实姓名"),this.checkGrounpList[0].childrenStatus.forEach(e=>{e.status=!0})),a.bank_card&&(this.checkGrounpList[2].checkAll=!0,this.checkGrounpList[2].checkedChildren.push("银行卡号和开户信息"),this.checkGrounpList[2].childrenStatus.forEach(e=>{e.status=!0})),a.account_disabled&&a.account_black&&a.account_forbidden&&a.account_kick&&a.account_limit?(this.checkGrounpList[1].checkAll=!0,this.checkGrounpList[1].checkedChildren=this.checkGrounpList[1].children||[],this.checkGrounpList[1].childrenStatus.forEach(e=>{e.status=!0})):(a.account_disabled&&(this.checkGrounpList[1].checkedChildren.push("停号"),this.checkGrounpList[1].childrenStatus[0].status=!0),a.account_forbidden&&(this.checkGrounpList[1].checkedChildren.push("封号"),this.checkGrounpList[1].childrenStatus[1].status=!0),a.account_black&&(this.checkGrounpList[1].checkedChildren.push("黑名单"),this.checkGrounpList[1].childrenStatus[2].status=!0),a.account_kick&&(this.checkGrounpList[1].checkedChildren.push("踢出在线"),this.checkGrounpList[1].childrenStatus[3].status=!0),a.account_limit&&(this.checkGrounpList[1].checkedChildren.push("自我限制"),this.checkGrounpList[1].childrenStatus[4].status=!0)),a.qq&&a.mobile&&a.email&&a.weixin&&a.skype&&a.answer&&a.birth&&a.address&&a.gender&&a.nationality&&a.language&&a.idcard?(this.checkGrounpList[3].checkAll=!0,this.checkGrounpList[3].checkedChildren=this.checkGrounpList[3].children||[],this.checkGrounpList[3].childrenStatus.forEach(e=>{e.status=!0})):(a.qq&&(this.checkGrounpList[3].checkedChildren.push("qq"),this.checkGrounpList[3].childrenStatus[0].status=!0),a.mobile&&(this.checkGrounpList[3].checkedChildren.push("手机号码"),this.checkGrounpList[3].childrenStatus[1].status=!0),a.email&&(this.checkGrounpList[3].checkedChildren.push("邮箱"),this.checkGrounpList[3].childrenStatus[2].status=!0),a.weixin&&(this.checkGrounpList[3].checkedChildren.push("微信"),this.checkGrounpList[3].childrenStatus[3].status=!0),a.skype&&(this.checkGrounpList[3].checkedChildren.push("skype"),this.checkGrounpList[3].childrenStatus[4].status=!0),a.answer&&(this.checkGrounpList[3].checkedChildren.push("安全问题与答案"),this.checkGrounpList[3].childrenStatus[5].status=!0),a.birth&&(this.checkGrounpList[3].checkedChildren.push("出生日期"),this.checkGrounpList[3].childrenStatus[6].status=!0),a.address&&(this.checkGrounpList[3].checkedChildren.push("出生地"),this.checkGrounpList[3].childrenStatus[7].status=!0),a.gender&&(this.checkGrounpList[3].checkedChildren.push("性别"),this.checkGrounpList[3].childrenStatus[8].status=!0),a.nationality&&(this.checkGrounpList[3].checkedChildren.push("邮编与国籍"),this.checkGrounpList[3].childrenStatus[9].status=!0),a.language&&(this.checkGrounpList[3].checkedChildren.push("货币与语言"),this.checkGrounpList[3].childrenStatus[10].status=!0),a.idcard&&(this.checkGrounpList[3].checkedChildren.push("身份证号码"),this.checkGrounpList[3].childrenStatus[11].status=!0)),s.updateList=[];let h=-1,o=-1;i.forEach((e,t)=>{e.action&&e.action.length>0&&(h=t,e.children&&e.children.length>0&&e.children.forEach((e,t)=>{o=t,e.action&&e.action.length>0&&s.setActions(e.action,h,o)}))}),s.editFormTtile="修改子帐号",s.btnEditText="修改",s.editFormVisible=!0,setTimeout(function(){0===s.updateList.length?s.$refs.tree.setCheckedKeys([]):s.$refs.tree.setCheckedKeys(s.updateList)},300)}s.loading=!1},p:()=>{},error:e=>{console.log(e)}}).catch(e=>{s.loading=!1,this.$message.error(e+LANG["未知错误，请稍后重试"]||"未知错误，请稍后重试")})},getEditChildren(e){let t=[];return(e.children||[]).forEach(e=>{t.push({action:[],id:e.id,name:e.name,path:e.path})}),t}},computed:{},mounted(){},created(){this.init()}};var l=function(e){s(500)},d=Object(r.a)(o,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"clearfix",attrs:{id:"childRoleAccount"}},[s("el-col",{staticClass:"pb"},[s("el-button",{staticClass:"addManage",attrs:{type:"primary",size:"small"},domProps:{textContent:e._s(e.LANG["新增角色"]||"新增角色")},on:{click:e.doAdd}})],1),e._v(" "),s("el-col",[s("tablegrid",{attrs:{columnsUrl:e.columnsUrl,tableUrl:e.tableUrl,tableCheck:!1,pageSet:!0,showRefresh:!0,updated:e.updated},on:{"do-handle":e.doHandle}})],1),e._v(" "),s("el-col",[s("el-dialog",{staticClass:"fromTitle",attrs:{title:e.editFormTtile,size:"small"},model:{value:e.editFormVisible,callback:function(t){e.editFormVisible=t},expression:"editFormVisible"}},[s("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"100px",rules:e.editFormRules}},[s("el-form-item",{attrs:{label:e.LANG["角色名称"]||"角色名称",prop:"role"}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:e.editForm.role,callback:function(t){e.$set(e.editForm,"role",t)},expression:"editForm.role"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.LANG["菜单权限"]||"菜单权限",prop:""}},[s("el-tree",{ref:"tree",attrs:{data:e.permissionsList,"show-checkbox":"",accordion:"","node-key":"id",props:e.defaultProps}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.LANG["会员权限"]||"会员权限"}},[s("checkgroup",{attrs:{checkGrounpList:e.checkGrounpList}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.LANG["导出权限"]||"导出权限"}},[s("checkgroup",{attrs:{checkGrounpList:e.checkExportList}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{nativeOn:{click:function(t){return e.resetForm(t)}}},[e._v(e._s(e.LANG["取消"]||"取消"))]),e._v(" "),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.saveFrom(t)}}},[e._v(e._s(e.LANG[e.btnEditText]||e.btnEditText))])],1)],1),e._v(" "),s("confirm",{attrs:{confirmConfig:e.confirmConfig},on:{"do-confirm":e.doConfirm}})],1)],1)},[],!1,l,"data-v-1b995e2d",null);t.default=d.exports},500:function(e,t,s){},501:function(e,t,s){}}]);